# linux 的多任务设计

- 进程
    多任务操作系统的核心概念之一， linux 的多任务是靠着进程实现的。
    对于进程的运行来说，内存就是进程生存和耕耘的空间，但是不同进程启动运行的时机不同，直接以物理地址来访问内存是非常不安全的，因为这样所有进程都运行在了同样的地址空间下，无法实现隔离，进程之间的内存占用交错，想想就很混乱。
    - 保护模式
        boot 为加载内核进行准备，然后进入保护模式运行起内核的第一个进程，该进程再进一步fork，开启其他内核进程，最后就可以运行起用户进程。
        在保护模式下，采用进程使用虚拟地址访问内存，32位系统下每个进程有 4GB 的内存空间。linux 下低地址的 3GB 是用户空间。3GB ~ 4GB 的 1GB 地址空间是内核空间。
        - 内核空间的存在意义
            保护模式下所有的进程都是运行在虚拟内存空间中的，包括内核进程，但是用户进程执行系统调用需要内核处理，所以所有进程都必须有一份相同的内核空间，这 1GB 的内核空间在所有进程中映射的物理地址都是相同的。

- 线程

- 进程栈 线程栈 内核栈 中断栈
    进程栈使用的就是栈段空间，实际上进程栈是给进程的主线程使用的，而同一进程下的线程切换不需要更换页表，所以进程栈区空间是共用的，所以子线程不能够直接使用进程栈作为自己的栈。
    线程栈为子线程自己的栈，这个栈空间位置在进程用户空间的 mmap 段，每个子线程都有自己的一份。但是不同于进程栈，线程栈没有动态扩容的能力，一旦线程栈用尽则直接栈溢出了。
    内核栈是进程进行内核调用所使用的栈，每个进程都有一份，位于内核空间。
    中断栈也位于内核空间。
